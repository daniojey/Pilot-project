{% extends "base.html" %}
{% load static %}



{% block content %}
<meta charset="UTF-8">
<link rel="stylesheet" type="text/css" href="{% static 'css/index.css' %}">  
<meta name="viewport" content="width=device-width, initial-scale=1">

<body align='center'>
    
    <div class="test-group-container">
        <div class="test-group">
            <div class="group-header" onclick="toggleGroup('group-1')">
                <h3>{{ group }}</h3>
                <span class="arrow"></span> <!-- Стрелка вниз -->
            </div>
            <div id="group-1" class="group-content">
                <!-- Здесь будут категории и тесты для группы 1 -->
                <div class="category">
                    <h3 align='left'>Невиконані тести</h3>
                    <div class="tests">
                        <!-- Тесты первой категории -->
                        {% for test in uncompleted_tests %}
                            <a href="{% url "tests:test_preview" test_id=test.id %}" class="test-item-link">
                                <div class="test-item"
                                data-bg="{% if test.image %}{{ test.image.url }}{% else %}{% static 'default-image.jpg' %}{% endif %}">
                                    <div class="test-overlay-header">
                                        {{ test.name }}
                                    </div>
                                    <!-- Нижняя полоса с датами -->
                                    <div class="test-overlay-footer">
                                        <div class="date-icon">
                                            <img src="{% static "icons/calendar.svg" %}" alt="calendar">
                                            <span>{{ test.date_taken|date:"d.m.Y" }} - {{ test.date_out|date:"d.m.Y" }}</span>
                                        </div>
                                    </div>
                                </div>
                            </a>    
                        {% endfor %}
                        </div>
                    </div>
                <div class="category">
                    <h3 align='left'>Очікують на перевірку</h3>
                    <div class="tests">
                        {% for test in awaiting_tests %}
                                <a href="{% url "tests:test_preview" test_id=test.id %}" class="test-item-link">
                                    <div class="test-item" 
                                    data-bg="{% if test.image %}{{ test.image.url }}{% else %}{% static 'default-image.jpg' %}{% endif %}">
                                        <div class="test-overlay-header">
                                            {{ test.name }}
                                        </div>
                                        <!-- Нижняя полоса с датами -->
                                        <div class="test-overlay-footer">
                                            <div class="date-icon">
                                                <img src="{% static "icons/calendar.svg" %}" alt="calendar">
                                                <span>{{ test.date_taken|date:"d.m.Y" }} - {{ test.date_out|date:"d.m.Y" }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </a>    
                        {% endfor %}
                    </div>
                </div>
                <div class="category">
                    <h3 align='left'>Пройдені тести</h3>
                    <div class="tests">
                        {% for test in completed_tests %}
                                <a href="{% url "tests:test_preview" test_id=test.id %}" class="test-item-link">
                                    <div class="test-item" 
                                    data-bg="{% if test.image %}{{ test.image.url }}{% else %}{% static 'default-image.jpg' %}{% endif %}">
                                        <div class="test-overlay-header">
                                            {{ test.name }}
                                        </div>
                                        <!-- Нижняя полоса с датами -->
                                        <div class="test-overlay-footer">
                                            <div class="date-icon">
                                                <img src="{% static "icons/calendar.svg" %}" alt="calendar">
                                                <span>{{ test.date_taken|date:"d.m.Y" }} - {{ test.date_out|date:"d.m.Y" }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </a>    
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        
    </div>
</body>
    
<script>
    function toggleGroup(groupId) {
        var groupContent = document.getElementById(groupId);
        var arrow = groupContent.previousElementSibling.querySelector('.arrow'); // Находим стрелку в заголовке

        if (groupContent.style.display === "none" || groupContent.style.display === "") {
            groupContent.style.display = "block";
            arrow.classList.add("rotate"); // Поворачиваем стрелку
        } else {
            groupContent.style.display = "none";
            arrow.classList.remove("rotate"); // Возвращаем стрелку в исходное положение
        }
    }
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const lazyBackgrounds = document.querySelectorAll(".test-item[data-bg]");
    
        // Проверяем, поддерживает ли браузер Intersection Observer
        if ("IntersectionObserver" in window) {
            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        const element = entry.target;
                        const bgUrl = element.getAttribute("data-bg");
                        if (bgUrl) {
                            element.style.backgroundImage = `url('${bgUrl}')`;
                            element.removeAttribute("data-bg"); // Удаляем атрибут после установки
                            observer.unobserve(element); // Останавливаем наблюдение
                        }
                    }
                });
            });
    
            lazyBackgrounds.forEach((bg) => observer.observe(bg));
        } else {
            // Если Intersection Observer не поддерживается, загружаем сразу
            lazyBackgrounds.forEach((bg) => {
                const bgUrl = bg.getAttribute("data-bg");
                if (bgUrl) {
                    bg.style.backgroundImage = `url('${bgUrl}')`;
                    bg.removeAttribute("data-bg");
                }
            });
        }
    });
</script>

{% endblock content %}